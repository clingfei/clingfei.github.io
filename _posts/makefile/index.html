<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Makefile学习" /><meta property="og:locale" content="en" /><meta name="description" content="Learning by Doing." /><meta property="og:description" content="Learning by Doing." /><link rel="canonical" href="https://clingfei.github.io/_posts/makefile/" /><meta property="og:url" content="https://clingfei.github.io/_posts/makefile/" /><meta property="og:site_name" content="clingfei" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-03T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Makefile学习" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-31T07:21:54+00:00","datePublished":"2022-01-03T00:00:00+00:00","description":"Learning by Doing.","headline":"Makefile学习","mainEntityOfPage":{"@type":"WebPage","@id":"https://clingfei.github.io/_posts/makefile/"},"url":"https://clingfei.github.io/_posts/makefile/"}</script><title>Makefile学习 | clingfei</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="clingfei"><meta name="application-name" content="clingfei"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/favicons/head.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">clingfei</a></div><div class="site-subtitle font-italic">行则将至</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/clingfei" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://www.zhihu.com/people/qffds" aria-label="zhihu" target="_blank" rel="noopener noreferrer"> <i class="fab fa-zhihu"></i> </a> <a href="javascript:location.href = 'mailto:' + ['clf700383','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Makefile学习</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Makefile学习</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1641168000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 3, 2022 </em> </span> <span> Updated <em class="" data-ts="1659252114" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 31, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/clingfei">clingfei</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4120 words"> <em>22 min</em> read</span></div></div></div><div class="post-content"><blockquote><p>Learning by Doing.</p></blockquote><h1 id="makefile学习">Makefile学习</h1><h3 id="makefile规则"><span class="mr-2">Makefile规则</span><a href="#makefile规则" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nl">tareget ... </span><span class="o">:</span> <span class="nf">prerequisites ...</span>
<span class="err">command</span>
<span class="err">...</span>
<span class="err">...</span>
</pre></table></code></div></div><p>target是目标文件，可以是Object File 也可以是执行文件，还可以是标签（label), prerequisites是生成target需要的文件或目标</p><p>command是make需要执行的指令</p><p>如果prerequisites中有任何一个文件比target要新，command中的命令就会被执行</p><h3 id="example"><span class="mr-2">Example</span><a href="#example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="nl">edit </span><span class="o">:</span> <span class="nf">main.o kbd.o command.o display.o </span>\
<span class="nf">insert.o search.o files.o utils.o</span>
	cc <span class="nt">-o</span> edit main.o kbd.o command.o display.o <span class="se">\</span>
insert.o search.o files.o utils.o
<span class="nl">main.o </span><span class="o">:</span> <span class="nf">main.c defs.h</span>
	cc <span class="nt">-c</span> main.c
<span class="nl">kbd.o </span><span class="o">:</span> <span class="nf">kbd.c defs.h command.h</span>
	cc <span class="nt">-c</span> kbd.c
<span class="nl">command.o </span><span class="o">:</span> <span class="nf">command.c defs.h command.h</span>
	cc <span class="nt">-c</span> command.c
<span class="nl">display.o </span><span class="o">:</span> <span class="nf">display.c defs.h buffer.h</span>
	cc <span class="nt">-c</span> display.c
<span class="nl">insert.o </span><span class="o">:</span> <span class="nf">insert.c defs.h buffer.h</span>
	cc <span class="nt">-c</span> insert.c
<span class="nl">search.o </span><span class="o">:</span> <span class="nf">search.c defs.h buffer.h</span>
	cc <span class="nt">-c</span> search.c
<span class="nl">files.o </span><span class="o">:</span> <span class="nf">files.c defs.h buffer.h command.h</span>
	cc <span class="nt">-c</span> files.c
<span class="nl">utils.o </span><span class="o">:</span> <span class="nf">utils.c defs.h</span>
	cc <span class="nt">-c</span> utils.c
<span class="nl">clean </span><span class="o">:</span>
	<span class="nb">rm </span>edit main.o kbd.o command.o display.o <span class="se">\</span>
	insert.o search.o files.o utils.o	
</pre></table></code></div></div><p>上面的代码中，目标文件中包含了执行文件和中间目标文件（即*.o），依赖文件就是目标文件冒号后面的文件。这样就构成了最终的目标文件与原始代码之间的依赖关系。</p><p>在依赖关系后，后续的command定义了如何生成目标文件的命令，以tab开头。</p><p>clean是一个动作名字，执行其后的命令可以需要在make后手动添加标签，即 <code class="language-plaintext highlighter-rouge">make clean</code>，类似地，可以在一个makefile中定义不用的编译或编译无关的命令，如打包/备份等。</p><h3 id="变量"><span class="mr-2">变量</span><a href="#变量" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>在makefile中可以使用变量来简化文件的编写。在makefile中变量可以被视为字符串，类似于C中的宏？</p><p>例如：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>object = main.o kbd.o command.o display.o insert.o searach.o files.o utils.o
</pre></table></code></div></div><p>则可以通过$(objects)来使用这个变量。这样，上面的代码就可以化简为：</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="err">insert.o</span> <span class="err">search.o</span> <span class="err">files.o</span> <span class="err">utils.o</span>
<span class="nl">edit </span><span class="o">:</span> <span class="nf">$(objects)</span>
	cc <span class="nt">-o</span> edit <span class="p">$(</span>objects<span class="p">)</span>
<span class="nl">main.o </span><span class="o">:</span> <span class="nf">main.c defs.h</span>
	cc <span class="nt">-c</span> main.c
<span class="nl">kbd.o </span><span class="o">:</span> <span class="nf">kbd.c defs.h command.h</span>
	cc <span class="nt">-c</span> kbd.c
<span class="nl">command.o </span><span class="o">:</span> <span class="nf">command.c defs.h command.h</span>
	cc <span class="nt">-c</span> command.c
<span class="nl">display.o </span><span class="o">:</span> <span class="nf">display.c defs.h buffer.h</span>
	cc <span class="nt">-c</span> display.c
<span class="nl">insert.o </span><span class="o">:</span> <span class="nf">insert.c defs.h buffer.h</span>
	cc <span class="nt">-c</span> insert.c
<span class="nl">search.o </span><span class="o">:</span> <span class="nf">search.c defs.h buffer.h</span>
	cc <span class="nt">-c</span> search.c
<span class="nl">files.o </span><span class="o">:</span> <span class="nf">files.c defs.h buffer.h command.h</span>
	cc <span class="nt">-c</span> files.c
<span class="nl">utils.o </span><span class="o">:</span> <span class="nf">utils.c defs.h</span>
	cc <span class="nt">-c</span> utils.c
<span class="nl">clean </span><span class="o">:</span>
	<span class="nb">rm </span>edit <span class="p">$(</span>objects<span class="p">)</span>
</pre></table></code></div></div><h3 id="自动推导"><span class="mr-2">自动推导</span><a href="#自动推导" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>make看到.o文件，会自动把.c文件作为他的依赖，并且 cc -c xxx.c也会被自动推导出来。则可进一步化简为：</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nv">objects</span> <span class="o">=</span> main.o kbd.o command.o display.o <span class="se">\</span>
insert.o search.o files.o utils.o
<span class="nl">edit </span><span class="o">:</span> <span class="nf">$(objects)</span>
	cc <span class="nt">-o</span> edit <span class="p">$(</span>objects<span class="p">)</span>
<span class="nl">$(objects) </span><span class="o">:</span> <span class="nf">defs.h</span>
<span class="nl">kbd.o command.o files.o </span><span class="o">:</span> <span class="nf">command.h</span>
<span class="nl">display.o insert.o search.o files.o </span><span class="o">:</span> <span class="nf">buffer.h</span>
<span class="nl">.PHONY </span><span class="o">:</span> <span class="nf">clean</span>
<span class="nl">clean </span><span class="o">:</span>
	<span class="nb">rm </span>edit <span class="p">$(</span>objects<span class="p">)</span>
</pre></table></code></div></div><p>.PHONY说明clean是一个伪目标文件。</p><p>.delete_on_error: 如果一条命令返回一个非零返回值，make将会停止执行命令。如果在makefile中添加了delete_on_error，那么在make失败时将会删除掉新编译出的target。</p><h3 id="引用其他的makefile"><span class="mr-2">引用其他的Makefile</span><a href="#引用其他的makefile" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Makefile中可以使用include关键字将别的Makefile包含进来。include和文件名之间可以用一个或多个空格隔开。</p><p>Makefile寻找文件的顺序：</p><ol><li>显式指出的文件位置<li>当前目录<li>如果make 执行时有-l 或 –include-dir参数，那么make就会在这个参数所指定的目录下去寻找。<li>如果&lt;prefix&gt;/include (e.g. /usr/local/bin或/usr/include)存在,make会到该目录下去寻找.</ol><p>如果有文件没有找到，make会生成警告，但不会立刻退出，而是继续载入其他文件，在完成整个makefile的读取后，make再重试这些没有找到或无法读取的文件。若需要make跳过无法读取的文件，则需要在include前加一个’-‘.</p><h2 id="规则"><span class="mr-2">规则</span><a href="#规则" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>规则包含两个部分，一个是依赖关系，另一个是生成目标的方法。</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nl">tareget ... </span><span class="o">:</span> <span class="nf">prerequisites ...</span>
<span class="err">command</span>
<span class="err">...</span>
<span class="err">...</span>
</pre></table></code></div></div><p>Makefile中存在特殊变量VPATH，如果没有指明这个变量，make会在当前的目录中寻找文件的依赖关系。如果在当前目录中没有找到，会到VPATH所指明的目录中寻找。</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>VPATH = src:../headers
</pre></table></code></div></div><p>如上，makefile将会按照src, ../headers这样的顺序寻找，不同的目录之间用’:’分割。</p><p>另一个设置文件搜索路径的方法：使用make的vpath关键字</p><ol><li>vpath &lt;pattern&gt; &lt;directories&gt; : 为符合模式pattern的文件指定搜索目录<li>vpath &lt;pattern&gt; ： 清除符合模式pattern的文件的搜索目录<li>vpath：清除所有被设置好的文件搜索目录</ol><p>pattern中需要包含%，匹配零或若干字符。例如:</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="err">vpath</span> <span class="err">%.h</span> <span class="err">../headers</span>
</pre></table></code></div></div><p>表示在../headers目录下搜索所有以.h结尾的文件</p><h3 id="隐式规则"><span class="mr-2">隐式规则</span><a href="#隐式规则" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>编译C代码：n.o通过命令<code class="language-plaintext highlighter-rouge">$(CC) -c $(CPPFLAGS) $(CFLAGS)</code>，依赖于文件n.c，自动编译出.o文件<li>编译C++代码：n.o通过命令<code class="language-plaintext highlighter-rouge">$(CXX) -c $(CPPFLAGS) $(CXXFLAGS)</code>，依赖于文件n.cc或n.cpp，自动编译出.o文件。<li>链接单个.o文件：n通过<code class="language-plaintext highlighter-rouge">$(CC) $(LDFLAGS) n.o $(LOADLIBES) $(LDLIBS)</code>，自动编译成可执行文件。</ul><p>其中使用的变量分别为：</p><ul><li>CC: 编译C代码使用的编译器，默认为cc<li>CXX: 编译C++代码使用的编译器，默认为g++<li>CFLAGS: C编译器使用的额外参数<li>CXXFLAGS: C++编译器使用的额外参数<li>CPPFLAGS: 传递给C预处理器的额外参数<li>LDFLAGS: 调用链接器时链接器使用的参数</ul><p>例如：</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">CC</span> <span class="o">=</span> gcc
<span class="nl">blah</span><span class="o">:</span>  <span class="nf">blah.o</span>

<span class="nl">blah.c</span><span class="o">:</span>

<span class="nl">clean</span><span class="o">:</span> 
	<span class="nb">rm</span> <span class="nt">-f</span> blah<span class="k">*</span>
</pre></table></code></div></div><p>输出为:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>&gt; make
gcc    -c -o blah.o blah.c
gcc   blah.o   -o blah
</pre></table></code></div></div><h3 id="static-pattern-rules"><span class="mr-2">Static Pattern Rules</span><a href="#static-pattern-rules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nl">targets...</span><span class="o">:</span> <span class="nf">target-pattern: prereq-patterns ...</span>
	commands
</pre></table></code></div></div><p>The essence is that the given <code class="language-plaintext highlighter-rouge">target</code> is matched by the <code class="language-plaintext highlighter-rouge">target-pattern</code> (via a <code class="language-plaintext highlighter-rouge">%</code> wildcard). Whatever was matched is called the <em>stem</em>. The stem is then substituted into the <code class="language-plaintext highlighter-rouge">prereq-pattern</code>, to generate the target’s prereqs.</p><p>主要用于自动将.c文件编译成.o文件，例如：</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="err">//</span> <span class="err">manual</span> 
<span class="nv">objects</span> <span class="o">=</span> foo.o bar.o all.o
<span class="nl">all</span><span class="o">:</span> <span class="nf">$(objects)</span>

<span class="c"># These files compile via implicit rules
</span><span class="nl">foo.o</span><span class="o">:</span> <span class="nf">foo.c</span>
<span class="nl">bar.o</span><span class="o">:</span> <span class="nf">bar.c</span>
<span class="nl">all.o</span><span class="o">:</span> <span class="nf">all.c</span>

<span class="nl">all.c</span><span class="o">:</span>
	<span class="nb">echo</span> <span class="s2">"int main() { return 0; }"</span> <span class="o">&gt;</span> all.c

<span class="nl">%.c</span><span class="o">:</span>
	<span class="nb">touch</span> <span class="nv">$@</span>

<span class="nl">clean</span><span class="o">:</span>
	<span class="nb">rm</span> <span class="nt">-f</span> <span class="k">*</span>.c <span class="k">*</span>.o all
</pre></table></code></div></div><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nl">//auto</span><span class="o">:</span>
<span class="nv">objects</span> <span class="o">=</span> foo.o bar.o all.o
<span class="nl">all</span><span class="o">:</span> <span class="nf">$(objects)</span>

<span class="c"># These files compile via implicit rules
# Syntax - targets ...: target-pattern: prereq-patterns ...
# In the case of the first target, foo.o, the target-pattern matches foo.o and sets the "stem" to be "foo".
# It then replaces the '%' in prereq-patterns with that stem
</span><span class="nl">$(objects)</span><span class="o">:</span> <span class="nf">%.o: %.c</span>

<span class="nl">all.c</span><span class="o">:</span>
	<span class="nb">echo</span> <span class="s2">"int main() { return 0; }"</span> <span class="o">&gt;</span> all.c

<span class="nl">%.c</span><span class="o">:</span>
	<span class="nb">touch</span> <span class="nv">$@</span>

<span class="nl">clean</span><span class="o">:</span>
	<span class="nb">rm</span> <span class="nt">-f</span> <span class="k">*</span>.c <span class="k">*</span>.o all
</pre></table></code></div></div><p>区别在于，使用通配符的方式引入了<code class="language-plaintext highlighter-rouge">$(objects): %.o: %.c</code>自动为每个.o文件指定了其使用的其依赖的.c文件，而在手动方式中需要依次为每个.o文件指定.c文件，但是似乎只适用于.c文件与.o文件一对一的情况。</p><p>filter函数可以被用在static pattern rules中从变量中分离出正确的文件，例如:</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nv">obj_files</span> <span class="o">=</span> foo.result bar.o lose.o
<span class="nv">src_files</span> <span class="o">=</span> foo.raw bar.c lose.c

<span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">all</span>
<span class="nl">all</span><span class="o">:</span> <span class="nf">$(obj_files)</span>

<span class="nl">$(filter %.o,$(obj_files))</span><span class="o">:</span> <span class="nf">%.o: %.c   </span><span class="c">#</span><span class="nf"> 取出Object中的.o文件</span>
	<span class="nb">echo</span> <span class="s2">"target: </span><span class="nv">$@</span><span class="s2"> prereq: </span><span class="nv">$&lt;</span><span class="s2">"</span>
<span class="nl">$(filter %.result,$(obj_files))</span><span class="o">:</span> <span class="nf">%.result: %.raw   </span><span class="c">#</span><span class="nf"> 取出object中的.result文件</span>
	<span class="nb">echo</span> <span class="s2">"target: </span><span class="nv">$@</span><span class="s2"> prereq: </span><span class="nv">$&lt;</span><span class="s2">"</span> 

<span class="nl">%.c %.raw</span><span class="o">:</span>
	<span class="nb">touch</span> <span class="nv">$@</span>

<span class="nl">clean</span><span class="o">:</span>
	<span class="nb">rm</span> <span class="nt">-f</span> <span class="p">$(</span>src_files<span class="p">)</span>
</pre></table></code></div></div><h3 id="pattern-rules"><span class="mr-2">Pattern rules</span><a href="#pattern-rules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>%通配符匹配任何非空字符串，其他的字符匹配其自身。</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nl">%.o </span><span class="o">:</span> <span class="nf">%.c</span>
	<span class="p">$(</span>CC<span class="p">)</span> <span class="nt">-c</span> <span class="p">$(</span>CFLAGS<span class="p">)</span> <span class="p">$(</span>CPPFLAGS<span class="p">)</span> <span class="nv">$&lt;</span> <span class="nt">-o</span> <span class="nv">$@</span>
</pre></table></code></div></div><p>完整的makefile版本：</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nv">CC</span> <span class="o">=</span> gcc
<span class="nv">obj_files</span> <span class="o">=</span> blah.o test.o
<span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">all</span>

<span class="nl">all</span><span class="o">:</span> <span class="nf">$(obj_files)</span>
	
<span class="nl">$(obj_files)</span><span class="o">:</span> <span class="nf">%.o: %.c</span>
<span class="nl">%.c</span><span class="o">:</span>
<span class="err">等价于</span>
<span class="nl">%.o</span><span class="o">:</span> <span class="nf">%.c </span>
	<span class="p">$(</span>CC<span class="p">)</span> <span class="nt">-c</span> <span class="p">$(</span>CFLAGS<span class="p">)</span> <span class="p">$(</span>CPPFLAGS<span class="p">)</span> <span class="nv">$&lt;</span> <span class="nt">-o</span> <span class="nv">$@</span>
</pre></table></code></div></div><h3 id="双冒号规则"><span class="mr-2">双冒号规则：</span><a href="#双冒号规则" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>使用双冒号允许为一个target定义多条指令，如果使用单冒号，将会报warnning 并且只执行第二条指令</p><h3 id="伪目标"><span class="mr-2">伪目标</span><a href="#伪目标" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>如果需要一次性生成多个可执行文件，但只要输入一个make，并且所有的目标文件都写在一个makefile中，可以通过伪目标来实现：</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nl">all </span><span class="o">:</span> <span class="nf">prog1 prog2 prog3</span>
<span class="nl">.PHONY </span><span class="o">:</span> <span class="nf">all</span>
<span class="nl">prog1 </span><span class="o">:</span> <span class="nf">prog1.o utils.o</span>
	cc <span class="nt">-o</span> prog1 prog1.o utils.o
<span class="nl">prog2 </span><span class="o">:</span> <span class="nf">prog2.o</span>
	cc <span class="nt">-o</span> prog2 prog2.o
<span class="nl">prog3 </span><span class="o">:</span> <span class="nf">prog3.o sort.o utils.o</span>
	cc <span class="nt">-o</span> prog3 prog3.o sort.o utils.o
</pre></table></code></div></div><p>如上，声明了一个all伪目标，其依赖于其他三个目标。由于伪目标总是被执行，所以其依赖的三个目标总是不如all新，因此另外三条规则总是会被执行，于是就达到了一口气生成多个目标的目的。</p><h3 id="书写命令"><span class="mr-2">书写命令</span><a href="#书写命令" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>默认的shell为<code class="language-plaintext highlighter-rouge">/bin/sh</code>，可以在makefile开头通过设置变量SHELL来改变</p><h4 id="一-显示命令"><span class="mr-2">一、 显示命令</span><a href="#一-显示命令" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>make默认将执行的命令行在命令执行前输出到屏幕，若使用@在命令行前，则这个命令将不被显示。</p><p>若在make执行时带入参数-n 或 –just-print，则只是显示命令而不执行，可用于调试makefile，查看命令的执行顺序。</p><p>make -s 或 –slient可以全面禁止命令的显示</p><h4 id="二命令执行"><span class="mr-2">二、命令执行</span><a href="#二命令执行" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>如果让下一条命令在上一条命令执行的基础上进行，则应该使用’;’分隔这两条命令，而不是换行。例如：</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nl">exec</span><span class="o">:</span>
	<span class="nb">cd</span> /home/hchen<span class="p">;</span> <span class="nb">pwd</span>
</pre></table></code></div></div><p>中断或中止make，如果在执行make时在键盘输入<code class="language-plaintext highlighter-rouge">ctrl+c</code>，make将会删除其刚刚生成的targets</p><h4 id="三命令出错"><span class="mr-2">三、命令出错</span><a href="#三命令出错" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>忽视命令出错，即无论正确不正确都认为是正确的，则在命令前加’-‘。例如：</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nl">clean</span><span class="o">:</span>
	<span class="p">-</span><span class="nb">rm</span> <span class="nt">-f</span> <span class="k">*</span>.o
</pre></table></code></div></div><p>或给Make添加 -i或 –ignore-errors，忽略所有命令的报错</p><p>make -k 或 –keep-going，表示如果某条规则的命令出错了，那么终结该命令的执行，但继续执行其他规则</p><h4 id="四嵌套执行make"><span class="mr-2">四、嵌套执行make</span><a href="#四嵌套执行make" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>把不同模块或不同功能的源文件放在不同的目录中，可以在每个目录中都书写一个该目录的Makefile。例如，有一个子目录subdir,这个目录下有Makefile指明了这个目录下文件的编译规则，则父目录的Makefile可以这样， 其中应该使用$(MAKE)而不是使用make，这样传递给被调用的make的参数将不会影响正在使用的make：</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nv">new_contents</span> <span class="o">=</span> <span class="s2">"hello:</span><span class="se">\n\t</span><span class="s2">touch inside_file"</span>
<span class="nl">all</span><span class="o">:</span>
	<span class="nb">mkdir</span> <span class="nt">-p</span> subdir
	<span class="nb">printf</span> <span class="p">$(</span>new_contents<span class="p">)</span> | <span class="nb">sed</span> <span class="nt">-e</span> <span class="s1">'s/^ //'</span> <span class="o">&gt;</span> subdir/makefile
	<span class="nb">cd </span>subdir <span class="o">&amp;&amp;</span> <span class="p">$(</span>MAKE<span class="p">)</span>
	
<span class="nl">clean</span><span class="o">:</span>
	<span class="nb">rm</span> <span class="nt">-rf</span> subdir
</pre></table></code></div></div><h4 id="在make中使用export"><span class="mr-2">在Make中使用export</span><a href="#在make中使用export" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>export的语法与sh相同，功能相似，但是并不相关</p><p>export的功能是在上级makefile中创建的变量可以供被调用的下级makefile使用。</p><h4 id="define"><span class="mr-2">define</span><a href="#define" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>可以将相同的一组命令序列打包为一个特定的命令。</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">define</span> <span class="nv">run-yacc</span>
<span class="err">yacc</span> <span class="nf">$(</span><span class="nb">firstword</span> <span class="nv">$^</span><span class="p">)</span>
<span class="err">mv</span> <span class="err">y.tab.c</span> <span class="err">$@</span>
<span class="k">endef</span>
</pre></table></code></div></div><p>之后可以通过</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nl">foo.c</span><span class="o">:</span><span class="nf">foo.y</span>
	<span class="p">$(</span>run-yacc<span class="p">)</span>
</pre></table></code></div></div><p>执行定义的命令. define的命令在一个分离的shell中执行。</p><h4 id="命令行参数和override"><span class="mr-2">命令行参数和override</span><a href="#命令行参数和override" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>使用override标识符来通过命令行覆盖定义的变量，例如 在命令行中<code class="language-plaintext highlighter-rouge">make option_one=hi</code>:</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nb">override</span> <span class="nv">option_one</span> <span class="o">=</span> did_override

<span class="nv">option_two</span> <span class="o">=</span> not_override
<span class="nl">all</span><span class="o">:</span>
	<span class="nb">echo</span> <span class="p">$(</span>option_one<span class="p">)</span>
	<span class="nb">echo</span> <span class="p">$(</span>option_two<span class="p">)</span>
</pre></table></code></div></div><h4 id="target-specific-variables"><span class="mr-2">Target-specific variables</span><a href="#target-specific-variables" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nl">all</span><span class="o">:</span> <span class="nf">one = cool</span>

<span class="nl">all</span><span class="o">:</span> 
	<span class="nb">echo </span>one is defined: <span class="p">$(</span>one<span class="p">)</span>

<span class="nl">other</span><span class="o">:</span>
	<span class="nb">echo </span>one is nothing: <span class="p">$(</span>one<span class="p">)</span>
</pre></table></code></div></div><h3 id="使用变量"><span class="mr-2">使用变量</span><a href="#使用变量" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>变量在声明时需要指定初值，使用时需要加上$，例如：</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">objects</span> <span class="o">=</span> program.o foo.o utils.o
<span class="nl">program </span><span class="o">:</span> <span class="nf">$(objects)</span>
	cc <span class="nt">-o</span> program <span class="p">$(</span>objects<span class="p">)</span>
<span class="nl">$(objects) </span><span class="o">:</span> <span class="nf">defs.h</span>
</pre></table></code></div></div><h4 id="自动变量以及通配符"><span class="mr-2">自动变量以及通配符</span><a href="#自动变量以及通配符" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="table-wrapper"><table><thead><tr><th>自动变量<th>含义<tbody><tr><td>$@<td>target name<tr><td>$&lt;<td>dependency 第一个文件的名字<tr><td>$^<td>全部dependencies 名字，无重复<tr><td>$?<td>prerequisites中比target更新的文件名<tr><td>$+<td>全部dependencies名字，有重复，适用于在链接器中重复值有意义的情况</table></div><p><strong>变量嵌套：</strong>可以把变量的真实值放到后面定义。例如：</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">include_dirs</span> <span class="o">:=</span> <span class="nt">-Ifoo</span> <span class="nt">-Ibar</span>
<span class="nv">CFLAGS</span> <span class="o">:=</span> <span class="p">$(</span>include_dirs<span class="p">)</span> <span class="nt">-O</span>
</pre></table></code></div></div><p>这样前面的变量不能使用后面的变量，而只能使用他前面定义好了的变量</p><p><strong>变量替换：</strong>可以替换变量中共有的部分，例如</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">foo</span> <span class="o">:=</span> a.o b.o c.o
<span class="nv">bar</span> <span class="o">:=</span> <span class="p">$(</span>foo:.o<span class="o">=</span>.c<span class="p">)</span>
</pre></table></code></div></div><p>将foo中的.o全部替换为.c</p><p>静态模式替换:依赖于被替换字符串中有相同的模式，模式中必须包含一个%字符。例如：</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">foo</span> <span class="o">:=</span> a.o b.o c.o
<span class="nv">bar</span> <span class="o">:=</span> <span class="p">$(</span>foo:%.o<span class="o">=</span>%.c<span class="p">)</span>
</pre></table></code></div></div><p><strong>追加变量值：</strong>使用+=，例如：</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">objects</span> <span class="o">=</span> main.o foo.o bar.o utils.o
<span class="nv">objects</span> <span class="o">+=</span> another.o
</pre></table></code></div></div><h3 id="变量定义"><span class="mr-2">变量定义</span><a href="#变量定义" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>makefile中存在两种风格的变量定义：</p><ul><li>recursive: (<code class="language-plaintext highlighter-rouge">=</code>) 在命令被使用时产生而不是在被定义时生成完整的变量<li>simply expanded: (<code class="language-plaintext highlighter-rouge">:=</code>) 在命令被定义时生成完整的变量</ul><p>（可能看起来比较抽象，看看例子就懂了）</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c"># Recursive variable. print "later"
</span><span class="nv">one</span> <span class="o">=</span> one <span class="p">${</span>later_variable<span class="p">}</span>
<span class="c"># Simply expanded variable. Will not print "later"
</span><span class="nv">two</span> <span class="o">:=</span> two <span class="p">${</span>later_variable<span class="p">}</span>

<span class="nv">later_variable</span> <span class="o">=</span> later

<span class="nl">all</span><span class="o">:</span>
	<span class="nb">echo</span> <span class="p">$(</span>one<span class="p">)</span>
	<span class="nb">echo</span> <span class="p">$(</span>two<span class="p">)</span>
</pre></table></code></div></div><p>因为在one被定义时，仍然保持为<code class="language-plaintext highlighter-rouge">one ${later_variable}</code>，直到echo使用<code class="language-plaintext highlighter-rouge">$(one)</code>时才会查找<code class="language-plaintext highlighter-rouge">${later_variable}</code>对应的值。而two使用simply expanded定义，在定义时，到上面去查找latere_variable对应的值，而此时later_variable并没有被定义，为空值，因此two = two</p><p>因为此种特性，simply expanded可以用来向一个变量追加值，而recursive definitions将会抛出一个infinite loop error.</p><p><em>除了simplye expanded之外，还可以使用+=向变量追加值，两者的区别在于，+=默认使用一个空格分隔，而simply expanded可以自行调整空格的数量，见下例：</em></p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">one</span> <span class="o">=</span> hello
<span class="nv">one</span> <span class="o">:=</span> <span class="p">${</span>one<span class="p">}</span> three //输出为hello three

<span class="nv">one</span> <span class="o">:=</span> <span class="p">${</span>one<span class="p">}</span>three //输出为hellothree

<span class="nv">foo</span> <span class="o">:=</span> start
<span class="nv">foo</span> <span class="o">+=</span>moree  //输出为start moree
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">?=</code>仅仅在变量没有被定义时才会产生定义，e.g.:</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">one</span> <span class="o">=</span> hello
<span class="nv">one</span> <span class="o">?=</span> will not be <span class="nb">set</span>
<span class="nv">two</span> <span class="o">?=</span> will be <span class="nb">set</span>

<span class="nl">all</span><span class="o">:</span>
	<span class="nb">echo</span> <span class="p">$(</span>one<span class="p">)</span>
	<span class="nb">echo</span> <span class="p">$(</span>two<span class="p">)</span>
</pre></table></code></div></div><p>每一行末尾的空格不会被删除，而开头的空格会被删除，如果需要使用空格的变量，可以通过$(nullstring)来完成。</p><p><em>这里有个疑问：行末尾是指什么？在下面的例子中，with_spaces=hello ，最后输出的hello自带几个空格，而单独输出nullstring为”“，输出spacew为” “, 可以认为所谓的行开头指的是等号后面开始一直到本行结束，因此变量等于单个空格会直接被忽略而作为空值，若需要使用空格则需要再加一层引用。</em></p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nv">with_spaces</span> <span class="o">=</span> hello   <span class="c"># with_spaces has many spaces after "hello"</span>
<span class="nv">after</span> <span class="o">=</span> <span class="p">$(</span>with_spaces<span class="p">)</span>

<span class="nv">nullstring</span> <span class="o">=</span> 
<span class="nv">space</span> <span class="o">=</span> <span class="p">$(</span>nullstring<span class="p">)</span> <span class="c"># Make a variable with a single space.</span>

<span class="nl">all</span><span class="o">:</span> 
	<span class="nb">echo</span> <span class="s2">"</span><span class="p">$(</span><span class="s2">snullstring</span><span class="p">)</span><span class="s2">"</span>
	<span class="nb">echo</span> <span class="s2">"</span><span class="p">$(</span><span class="s2">space</span><span class="p">)</span><span class="s2">"</span>
	<span class="nb">echo</span> <span class="s2">"</span><span class="p">$(</span><span class="s2">after</span><span class="p">)</span><span class="s2">"</span>
	<span class="nb">echo </span>start<span class="s2">"</span><span class="p">$(</span><span class="s2">space</span><span class="p">)</span><span class="s2">"</span>end
</pre></table></code></div></div><h2 id="makefile中的条件判断"><span class="mr-2">Makefile中的条件判断</span><a href="#makefile中的条件判断" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h4 id="ifelse"><span class="mr-2">if/else</span><a href="#ifelse" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">foo</span> <span class="o">=</span> ok
<span class="nl">all</span><span class="o">:</span>
<span class="k">ifeq</span> <span class="nv">($(foo), ok)</span>
	<span class="nb">echo</span> <span class="s2">"foo equals ok"</span>
<span class="k">else</span> 
	<span class="nb">echo</span> <span class="s2">"nope"</span>
<span class="k">endif</span>
</pre></table></code></div></div><h4 id="判断是否为空"><span class="mr-2">判断是否为空</span><a href="#判断是否为空" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nv">nullstring</span> <span class="o">=</span> 
<span class="nv">foo</span> <span class="o">=</span> <span class="p">$(</span>nullstring<span class="p">)</span>

<span class="nl">all</span><span class="o">:</span>
<span class="k">ifeq</span> <span class="nv">($(strip $(foo)), )</span>
	<span class="nb">echo</span> <span class="s2">"foo is empty after being stripped"</span>
<span class="k">endif</span>
<span class="k">ifeq</span> <span class="nv">($(nullstring), )</span>
	<span class="nb">echo</span> <span class="s2">"nullstring doesn't even have spaces"</span>
<span class="k">endif</span>
</pre></table></code></div></div><h4 id="判断变量是否已被定义"><span class="mr-2">判断变量是否已被定义</span><a href="#判断变量是否已被定义" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nv">bar</span> <span class="o">=</span>
<span class="nv">foo</span> <span class="o">=</span> <span class="p">$(</span>bar<span class="p">)</span>
<span class="nl">all</span><span class="o">:</span>
<span class="k">ifdef</span> <span class="nv">foo</span>
	<span class="nb">echo</span> <span class="s2">"foo is defined"</span>
<span class="k">endif</span>
<span class="k">ifndef</span> <span class="nv">bar</span>
	<span class="nb">echo</span> <span class="s2">"buf bar is not"</span>
<span class="k">endif</span>
</pre></table></code></div></div><h4 id="makeflags"><span class="mr-2">$(makeflags)</span><a href="#makeflags" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>$(makeflags)表示make时通过命令行传递的参数</p><h2 id="functions"><span class="mr-2">Functions</span><a href="#functions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><code class="language-plaintext highlighter-rouge">$(fn, arguments)</code>， arguments之间不应当添加额外的空格， 除非需要。</p><h4 id="string-substitution"><span class="mr-2">String Substitution</span><a href="#string-substitution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><code class="language-plaintext highlighter-rouge">$(patsubst pattern,replacement,text)</code>：从text中选择与pattern匹配的单词，将其替换为replacement。其中pattern可以包含‘%’，如果replacement中也包含%，那么%将会被其对应的字符串替换。仅仅pattern中的第一个%会以这种方式被替换，后续的%将会保留。</p><h4 id="foreach"><span class="mr-2">foreach</span><a href="#foreach" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><code class="language-plaintext highlighter-rouge">$(forrach var,list,text)</code>：其中var是list中的每个单词，对于list中的每个var，将其替换为text</p><h4 id="if"><span class="mr-2">if</span><a href="#if" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><code class="language-plaintext highlighter-rouge">$(if this-is-not-empty,then!,else!)</code>，判断第一个参数是否为空值，若非空，则执行then，否则执行else.</p><h4 id="call"><span class="mr-2">call</span><a href="#call" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>makefile通过创建变量来定义函数，并且通过<code class="language-plaintext highlighter-rouge">$(0)</code>等向函数传递参数。</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">sweet_new_fn</span> <span class="o">=</span> Variable Name: <span class="p">$(</span>0<span class="p">)</span> First: <span class="p">$(</span>1<span class="p">)</span> Second: <span class="p">$(</span>2<span class="p">)</span> Empty Variable: <span class="p">$(</span>3<span class="p">)</span>

<span class="nl">all</span><span class="o">:</span>
	<span class="c"># Outputs "Variable Name: sweet_new_fn First: go Second: tigers Empty Variable:"</span>
	<span class="p">@</span><span class="nb">echo</span> <span class="p">$(</span>call sweet_new_fn, go, tigers<span class="p">)</span>
</pre></table></code></div></div><h4 id="shell-function"><span class="mr-2">shell function</span><a href="#shell-function" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nl">all</span><span class="o">:</span>
	<span class="nb">echo</span> <span class="p">$(</span>shell <span class="nb">ls</span> <span class="nt">-la</span><span class="p">)</span>
</pre></table></code></div></div><h2 id="reference"><span class="mr-2">REFERENCE</span><a href="#reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>[1]<a href="https://zhuanlan.zhihu.com/p/437667448">全网最牛Linux内核Makefile系统文件详解(纯文字代码) - 知乎 (zhihu.com)</a></p><p>[2]<a href="https://makefiletutorial.com/#string-substitution">Makefile Tutorial By Example</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/makefile/'>Makefile</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/makefile/" class="post-tag no-text-decoration" >Makefile</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Makefile%E5%AD%A6%E4%B9%A0%20-%20clingfei&url=https%3A%2F%2Fclingfei.github.io%2F_posts%2Fmakefile%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Makefile%E5%AD%A6%E4%B9%A0%20-%20clingfei&u=https%3A%2F%2Fclingfei.github.io%2F_posts%2Fmakefile%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fclingfei.github.io%2F_posts%2Fmakefile%2F&text=Makefile%E5%AD%A6%E4%B9%A0%20-%20clingfei" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/_posts/11.-%E7%9B%9B%E6%9C%80%E5%A4%9A%E6%B0%B4%E7%9A%84%E5%AE%B9%E5%99%A8/">LeetCode 11. 盛最多水的容器</a><li><a href="/_posts/C++-tricks/">C++ tricks</a><li><a href="/_posts/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%97%E9%9D%A2%E5%80%BC%E4%BD%9C%E4%B8%BA%E5%AE%9E%E5%8F%82%E6%97%B6,%E8%A2%AB%E5%AD%98%E6%94%BE%E5%9C%A8%E5%93%AA%E4%BA%86/">字符串字面值作为实参时，被放在哪了？</a><li><a href="/_posts/LeetCode-761%E9%A2%98%E8%A7%A3/">LeetCode 761 特殊的二进制序列</a><li><a href="/_posts/seimi/">SEIMI</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/operating-system/">operating system</a> <a class="post-tag" href="/tags/xv6/">xv6</a> <a class="post-tag" href="/tags/distributed-systems/">Distributed Systems</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/">程序分析</a> <a class="post-tag" href="/tags/c-c/">C/C++</a> <a class="post-tag" href="/tags/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/">论文阅读</a> <a class="post-tag" href="/tags/debug/">debug</a> <a class="post-tag" href="/tags/gdb/">gdb</a> <a class="post-tag" href="/tags/llvm/">LLVM</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/_posts/%E4%B8%B2%E5%8F%A3%E8%B0%83%E8%AF%95/"><div class="card-body"> <em class="small" data-ts="1711843200" data-df="ll" > Mar 31, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>使用串口调试Linux内核</h3><div class="text-muted small"><p> 前置要求及环境配置 被调试的主机安装待调试内核，称为target，另一台装有稳定的Linux内核，称为host。 target主板上带有原生com口，不能使用USB转接；需要一台USB转串口母线，连接target串口和host 本文使用的target架构为aarch64, 系统为openeuler，内核为Linux-5.10, host架构为x86-64, 系统为ubuntu 20.0...</p></div></div></a></div><div class="card"> <a href="/_posts/%E4%BD%BF%E7%94%A8qemu%E8%BF%9B%E8%A1%8CLinux%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95/"><div class="card-body"> <em class="small" data-ts="1694390400" data-df="ll" > Sep 11, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>使用qemu进行Linux内核调试</h3><div class="text-muted small"><p> 一篇创建于2023.9.11，完成于2024.3.31，拖了大半年的文章 调试前的准备 编译qemu 在ubuntu中可以通过apt安装qemu-system，也可以从源码自行编译。在编译qemu-8.0时，可能遇到kvm Parameter &#39;type&#39; expects a netdev backend type，原因是因为在编译时没有enable-slirp，而enab...</p></div></div></a></div><div class="card"> <a href="/_posts/Linux-TTBR1/"><div class="card-body"> <em class="small" data-ts="1691971200" data-df="ll" > Aug 14, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Linux下的TTBR1_EL1寄存器使用探究</h3><div class="text-muted small"><p> 本文分析基于Linux-5.10.100，架构基于ARM64 V8.3，假设页表映射层级为4，即CONFIG_ARM64_PGTABLE_LEVELS=4，地址宽度为48，即CONFIG_ARM64_VA_BITS=48。 在Linux系统中，通过MMU进行虚实地址转换时，会依赖于TTBR1_EL1和TTBR0_EL0两个寄存器。其中TTBR1_EL1指向内核地址空间的页表基地...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/_posts/AES/" class="btn btn-outline-primary" prompt="Older"><p>AES算法的经典实现</p></a> <a href="/_posts/%E7%A7%8B%E6%8B%9B/" class="btn btn-outline-primary" prompt="Newer"><p>秋招补录不完全指南</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/operating-system/">operating system</a> <a class="post-tag" href="/tags/xv6/">xv6</a> <a class="post-tag" href="/tags/distributed-systems/">Distributed Systems</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/">程序分析</a> <a class="post-tag" href="/tags/c-c/">C/C++</a> <a class="post-tag" href="/tags/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/">论文阅读</a> <a class="post-tag" href="/tags/debug/">debug</a> <a class="post-tag" href="/tags/gdb/">gdb</a> <a class="post-tag" href="/tags/llvm/">LLVM</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/clingfei">clingfei</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
