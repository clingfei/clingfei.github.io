<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Linux内核模块签名与版本检查机制" /><meta property="og:locale" content="en" /><meta name="description" content="clingfei’s blog" /><meta property="og:description" content="clingfei’s blog" /><link rel="canonical" href="https://clingfei.github.io/_posts/Linux%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97%E7%AD%BE%E5%90%8D%E4%B8%8E%E7%89%88%E6%9C%AC%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/" /><meta property="og:url" content="https://clingfei.github.io/_posts/Linux%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97%E7%AD%BE%E5%90%8D%E4%B8%8E%E7%89%88%E6%9C%AC%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/" /><meta property="og:site_name" content="clingfei" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-05-12T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Linux内核模块签名与版本检查机制" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-05-12T00:00:00+00:00","datePublished":"2023-05-12T00:00:00+00:00","description":"clingfei’s blog","headline":"Linux内核模块签名与版本检查机制","mainEntityOfPage":{"@type":"WebPage","@id":"https://clingfei.github.io/_posts/Linux%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97%E7%AD%BE%E5%90%8D%E4%B8%8E%E7%89%88%E6%9C%AC%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/"},"url":"https://clingfei.github.io/_posts/Linux%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97%E7%AD%BE%E5%90%8D%E4%B8%8E%E7%89%88%E6%9C%AC%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/"}</script><title>Linux内核模块签名与版本检查机制 | clingfei</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="clingfei"><meta name="application-name" content="clingfei"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/favicons/head.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">clingfei</a></div><div class="site-subtitle font-italic">行则将至</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/clingfei" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://www.zhihu.com/people/qffds" aria-label="zhihu" target="_blank" rel="noopener noreferrer"> <i class="fab fa-zhihu"></i> </a> <a href="javascript:location.href = 'mailto:' + ['clf700383','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Linux内核模块签名与版本检查机制</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Linux内核模块签名与版本检查机制</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1683849600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> May 12, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/clingfei">clingfei</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1396 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><hr /><h2 id="内核模块签名机制"><span class="mr-2">内核模块签名机制</span><a href="#内核模块签名机制" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>linux内核从3.7 开始加入模块签名检查机制， 校验签名是否与已编译的内核公钥匹配。目前只支持RSA X.509验证， 模块签名验证并非强制使用， 可在编译内核时配置是否开启。</p><h4 id="config_module_sig-module-signature-verification"><span class="mr-2">CONFIG_MODULE_SIG: Module signature verification</span><a href="#config_module_sig-module-signature-verification" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>开启该选项后，内核加载该模块时会对内核模块的签名进行检查。默认情况下，在加载没有签名或签名不正确的内核模块时，仅打印一条提示信息，将内核标记为tainted，然后继续加载该模块。</p><h4 id="config_module_sig_force-require-modules-to-be-validly-signed"><span class="mr-2">CONFIG_MODULE_SIG_FORCE: Require modules to be validly signed</span><a href="#config_module_sig_force-require-modules-to-be-validly-signed" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>开启该选项后，在加载无签名或签名不正确的内核模块时，内核会直接拒绝加载签名有问题的内核模块。</p><h4 id="config_module_sig_allautomatically-sign-all-modules"><span class="mr-2">CONFIG_MODULE_SIG_ALL: Automatically sign all modules</span><a href="#config_module_sig_allautomatically-sign-all-modules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>kbuild在执行make modules_install时对所有的内核模块进行签名，若该选项未设置，则需要手动调用scripts/sign-file对内核模块进行签名</p><h4 id="config_module_sig_hash-设置签名算法"><span class="mr-2">CONFIG_MODULE_SIG_HASH: 设置签名算法</span><a href="#config_module_sig_hash-设置签名算法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>包括：</p><ul><li>CONFIG_MODULE_SIG_SHA1：sha1<li>CONFIG_MODULE_SIG_SHA224：sha224<li>CONFIG_MODULE_SIG_SHA256：sha256<li>CONFIG_MODULE_SIG_SHA384：sha384<li>CONFIG_MODULE_SIG_SHA512：sha512</ul><h2 id="内核和驱动中的版本信息"><span class="mr-2">内核和驱动中的版本信息</span><a href="#内核和驱动中的版本信息" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Linux的内核版本号KERNELRELEASE在编译的过程中生成，存储在<code class="language-plaintext highlighter-rouge">include/config/kernel.release</code>文件中。</p><p>vermagic用于内核模块的版本检查，Linux内核的vermagic可以通过cat /proc/version来查看，而对于kernel module，可以通过modinfo来查看。其值由kernel Makefile中的VERMAGIC_STRING表示，其中UTS_RELEASE即为内核的KERNELRELEASE。：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>VERMAGIC_STRING = 	&lt;UTS_RELEASE&gt; ["SMP"] ["preempt"] ["mod_unload"]["modversions"]
</pre></table></code></div></div><p>为了确保Linux kernel和kernel module的二进制兼容性，会对导出符号进行CRC校验。kernel中导出的每一个符号都有一个CRC校验，而module中保存了每一个使用到的由kernel导出的symbol的CRC校验，在module加载时会检查二者是否匹配，如果不匹配将不会加载。</p><p>如果启动了CONFIG_MODVERSIONS，则每个通过EXPORT_SYMBOL定义输出的符号名都会计算一个CRC校验码。在编译kernel/module完成后，生成的Module.symvers文件中包含了kernel的所有的导出符号的CRC校验码。当module引用了kernel或其他module导出的符号时，在编译过程中需要读取kernel或者其他module的Module.symvers，而这些Module.symvers应该放到当前module的源码目录下，或在Makefile中通过KBUILD_EXTRA_SYMBOLS=来指定依赖的模块的Module.symvers的内容。</p><p>在编译生成的module.ko中，存在一个__versions section，其中保存了module所引用的符号和对应的CRC验证码，可以通过modprobe -dump-modversions来查看完整信息：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>$ modprobe -dump-modversions ixgbe.ko
	0x235a30d9      module_layout
	0x452ba683      ipv6_ext_hdr
	0xe2d5255a      strcmp
	0xb8b9f817      kmalloc_order_trace
	0x72128032      secpath_set
	0xd0760fc0      kfree_sensitive
	......
</pre></table></code></div></div><h2 id="模块加载时的检查步骤"><span class="mr-2">模块加载时的检查步骤</span><a href="#模块加载时的检查步骤" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>内核在加载模块时，首先会进行模块签名验证，然后进行版本检查。</p><p>版本检查分为vermagic检查和CRC校验检查，具体过程由CONFIG_MODVERSIONS相关控制：</p><ul><li>kernel打开CONFIG_MODVERSIONS，module不打开CONFIG_MODVERSIONS：将不会检查CRC，但是会完整匹配vermagic，此时kernel和module的vermagic的modversions不一致，模块将加载失败。<li>kernel和module都打开CONFIG_MODVERSIONS：检查CRC，然后匹配vermagic第一个空格后的部分，例如对于<code class="language-plaintext highlighter-rouge">vermagic: 5.12.10 SMP mod_unload modversions</code> ，只会匹配<code class="language-plaintext highlighter-rouge">SMP mod_unload modversions</code>。<li>kernel不打开CONFIG_MODVERSIONS，module打开CONFIG_MODVERSIONS：完整匹配kernel和module的vermagic，但是因为二者modversions不同，模块加载失败。<li>kernel和module均不打开CONFIG_MODVERSIONS：完整匹配vermagic，module加载成功。</ul><h2 id="如何关闭模块签名验证"><span class="mr-2">如何关闭模块签名验证</span><a href="#如何关闭模块签名验证" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>可以通过<code class="language-plaintext highlighter-rouge">strip --keep-file-symbols &lt;module_name&gt;</code>删除指定模块的签名。</p><p>内核中存在kernel_lockdown机制，用于阻止对于正在运行的内核映像的直接或间接地未经授权地访问，该机制开启与否由.config中的<code class="language-plaintext highlighter-rouge">CONFIG_SECURITY_LOCKDOWN_LSM</code>控制。通过将<code class="language-plaintext highlighter-rouge"> CONFIG_SECURITY_LOCKDOWN_LSM</code>和<code class="language-plaintext highlighter-rouge">CONFIG_MODULE_SIG</code>设置为n，编译出的驱动将不再包含签名，对应的内核在加载模块时也不会验证签名的正确性。而如果仅将<code class="language-plaintext highlighter-rouge">CONFIG_MODULE_SIG</code>设置为n，在后续通过<code class="language-plaintext highlighter-rouge">make olddefconfig</code>时，由于lockdown的存在，将会自动重新开启<code class="language-plaintext highlighter-rouge">CONFIG_MODULE_SIG</code>。</p><h2 id="如何忽略版本检查"><span class="mr-2">如何忽略版本检查</span><a href="#如何忽略版本检查" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>在modprobe中提供了两个选项，用于在加载模块时忽略vermagic或CRC检查：</p><p><strong>–force-vermagic</strong> Every module contains a small string containing important information, such as the kernel and compiler versions. If a module fails to load and the kernel complains that the “version magic” doesn’t match, you can use this option to remove it. Naturally, this check is there for your protection, so using this option is dangerous unless you know what you’re doing. This applies to any modules inserted: both the module (or alias) on the command line and any modules on which it depends.</p><p><strong>–force-modversion</strong> When modules are compiled with CONFIG_MODVERSIONS set, a section detailing the versions of every interfaced used by (or supplied by) the module is created. If a module fails to load and the kernel complains that the module disagrees about a version of some interface, you can use “–force-modversion” to remove the version information altogether. Naturally, this check is there for your protection, so using this option is dangerous unless you know what you’re doing. This applies any modules inserted: both the module (or alias) on the command line and any modules on which it depends.</p><p><strong>-f</strong>, <strong>–force</strong> Try to strip any versioning information from the module which might otherwise stop it from loading: this is the same as using both <strong>–force-vermagic</strong> and <strong>–force-modversion</strong>. Naturally, these checks are there for your protection, so using this option is dangerous unless you know what you are doing. This applies to any modules inserted: both the module (or alias) on the command line and any modules it on which it depends.</p><h3 id="reference"><span class="mr-2">Reference</span><a href="#reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>1.<a href="https://man7.org/linux/man-pages/man7/kernel_lockdown.7.html">kernel_lockdown(7) - Linux manual page (man7.org)</a></p><p>2.<a href="https://zhuanlan.zhihu.com/p/438216195">深入分析Linux kernel安全特性: 内核模块签名 - 知乎 (zhihu.com)</a></p><p>3.<a href="https://lishiwen4.github.io/linux-kernel/linux-kernel-module-signing">LINUX内核模块签名</a></p><p>4.<a href="https://lishiwen4.github.io/linux-kernel/linux-kernel-module-version-check">LINUX内核模块版本检查</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/operating-system/'>operating system</a>, <a href='/categories/linux/'>Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/operating-system/" class="post-tag no-text-decoration" >operating system</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Linux%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97%E7%AD%BE%E5%90%8D%E4%B8%8E%E7%89%88%E6%9C%AC%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6%20-%20clingfei&url=https%3A%2F%2Fclingfei.github.io%2F_posts%2FLinux%25E5%2586%2585%25E6%25A0%25B8%25E6%25A8%25A1%25E5%259D%2597%25E7%25AD%25BE%25E5%2590%258D%25E4%25B8%258E%25E7%2589%2588%25E6%259C%25AC%25E6%25A3%2580%25E6%259F%25A5%25E6%259C%25BA%25E5%2588%25B6%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Linux%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97%E7%AD%BE%E5%90%8D%E4%B8%8E%E7%89%88%E6%9C%AC%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6%20-%20clingfei&u=https%3A%2F%2Fclingfei.github.io%2F_posts%2FLinux%25E5%2586%2585%25E6%25A0%25B8%25E6%25A8%25A1%25E5%259D%2597%25E7%25AD%25BE%25E5%2590%258D%25E4%25B8%258E%25E7%2589%2588%25E6%259C%25AC%25E6%25A3%2580%25E6%259F%25A5%25E6%259C%25BA%25E5%2588%25B6%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fclingfei.github.io%2F_posts%2FLinux%25E5%2586%2585%25E6%25A0%25B8%25E6%25A8%25A1%25E5%259D%2597%25E7%25AD%25BE%25E5%2590%258D%25E4%25B8%258E%25E7%2589%2588%25E6%259C%25AC%25E6%25A3%2580%25E6%259F%25A5%25E6%259C%25BA%25E5%2588%25B6%2F&text=Linux%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97%E7%AD%BE%E5%90%8D%E4%B8%8E%E7%89%88%E6%9C%AC%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6%20-%20clingfei" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/_posts/11.-%E7%9B%9B%E6%9C%80%E5%A4%9A%E6%B0%B4%E7%9A%84%E5%AE%B9%E5%99%A8/">LeetCode 11. 盛最多水的容器</a><li><a href="/_posts/C++-tricks/">C++ tricks</a><li><a href="/_posts/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%97%E9%9D%A2%E5%80%BC%E4%BD%9C%E4%B8%BA%E5%AE%9E%E5%8F%82%E6%97%B6,%E8%A2%AB%E5%AD%98%E6%94%BE%E5%9C%A8%E5%93%AA%E4%BA%86/">字符串字面值作为实参时，被放在哪了？</a><li><a href="/_posts/LeetCode-761%E9%A2%98%E8%A7%A3/">LeetCode 761 特殊的二进制序列</a><li><a href="/_posts/seimi/">SEIMI</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/operating-system/">operating system</a> <a class="post-tag" href="/tags/xv6/">xv6</a> <a class="post-tag" href="/tags/distributed-systems/">Distributed Systems</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/">程序分析</a> <a class="post-tag" href="/tags/c-c/">C/C++</a> <a class="post-tag" href="/tags/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/">论文阅读</a> <a class="post-tag" href="/tags/debug/">debug</a> <a class="post-tag" href="/tags/gdb/">gdb</a> <a class="post-tag" href="/tags/llvm/">LLVM</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/_posts/Linux-%E5%86%85%E6%A0%B8%E4%B8%8E%E6%A8%A1%E5%9D%97%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/"><div class="card-body"> <em class="small" data-ts="1677801600" data-df="ll" > Mar 3, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Linux内核与模块数据交互方式总结</h3><div class="text-muted small"><p> 1. 通过Linux内核与模块之间的接口 定义静态全局变量，通过Linux内核与模块之间的接口，将全局变量的地址传递给kernel 以ixgbe驱动为例：模块中定义了static全局变量 ixgbe_driver: static struct pci_driver ixgbe_driver = { .name = ixgbe_driver_name, .id_table...</p></div></div></a></div><div class="card"> <a href="/_posts/Linux-TTBR1/"><div class="card-body"> <em class="small" data-ts="1691971200" data-df="ll" > Aug 14, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Linux下的TTBR1_EL1寄存器使用探究</h3><div class="text-muted small"><p> 本文分析基于Linux-5.10.100，架构基于ARM64 V8.3，假设页表映射层级为4，即CONFIG_ARM64_PGTABLE_LEVELS=4，地址宽度为48，即CONFIG_ARM64_VA_BITS=48。 在Linux系统中，通过MMU进行虚实地址转换时，会依赖于TTBR1_EL1和TTBR0_EL0两个寄存器。其中TTBR1_EL1指向内核地址空间的页表基地...</p></div></div></a></div><div class="card"> <a href="/_posts/MIT-6.s081-Lab-lazy-allocation/"><div class="card-body"> <em class="small" data-ts="1680739200" data-df="ll" > Apr 6, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MIT 6.s081 Lab lazy allocation</h3><div class="text-muted small"><p> Lab: xv6 lazy page allocation (mit.edu) Page-fault exceptions 当CPU无法将虚拟地址转换成物理地址时，生成一个page-fault excecption，称为缺页异常。RISC-V中存在三种类型的缺页异常：load(load指令)/store(store指令)/instruction(指令所在的虚拟地址无法转换成物...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/_posts/6.824-Lab3-Fault-tolerant-Key-Value-Service/" class="btn btn-outline-primary" prompt="Older"><p>Fault-tolerant Key/Value Service</p></a> <a href="/_posts/11.-%E7%9B%9B%E6%9C%80%E5%A4%9A%E6%B0%B4%E7%9A%84%E5%AE%B9%E5%99%A8/" class="btn btn-outline-primary" prompt="Newer"><p>LeetCode 11. 盛最多水的容器</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/operating-system/">operating system</a> <a class="post-tag" href="/tags/xv6/">xv6</a> <a class="post-tag" href="/tags/distributed-systems/">Distributed Systems</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/">程序分析</a> <a class="post-tag" href="/tags/c-c/">C/C++</a> <a class="post-tag" href="/tags/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/">论文阅读</a> <a class="post-tag" href="/tags/debug/">debug</a> <a class="post-tag" href="/tags/gdb/">gdb</a> <a class="post-tag" href="/tags/llvm/">LLVM</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/clingfei">clingfei</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
