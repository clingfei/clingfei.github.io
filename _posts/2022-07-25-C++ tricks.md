---
declare: true
title: C++ tricks
categories: [C++]
tags:
- C++ 
---

> 记录coding or reading时遇到的一些有趣的C++ tricks.

## \#\#

在预处理过程中通知预处理器将\#\#左边和右边的符号连接起来。

e.g.:

```c++
#define f(g, g2) g##g2
int main() {
	int var12 = 100;
	printf("%d", f(Var, 12)); // equal to printf("%d", var12);
}
```

## __attribute__((flatten))

\_\_attribute\_\_((always_inline))存在一种缺陷，即任何调用使用该属性修饰的函数的地方都会将函数内联，而不考虑该函数本身的长度。在极端情况下，由于内联产生的函数过大编译器会将其忽略。

e.g.:

```c++
__attribute__((always_inline)) inline void do_thing(int input) {
	// do something.
}
void hot_code() {
	while (condition) {
		...
		do_thing(y);
		...
	}
}
```

此时将会产生巨大的可执行文件，较长的编译时间和更差的cache局部性。

使用`__attribute__((flatten))`进行替代，编译器将会在合适的地方选择内联而在其他地方保持原样，从而尽可能避免inline的缺点。

## extern "C"

实际上是一个链接规范。在使用C++编译器，需要使用C头文件时使用，编译器将其编译成C++ ABI，以供链接器链接。

